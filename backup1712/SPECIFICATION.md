# Спецификация Функциональности: Проект TMSmini

**Ветка фичи**: `gemini-v1`
**Дата создания**: 2025-12-16
**Статус**: Черновик
**Референсные проекты**: `TMSmini_v.Antgrvt` (Функционал), `trans_scraper` (Дизайн)

## Пользовательские сценарии и тестирование

### История 1 - Автоматический поиск грузов (Приоритет: P1)

Как диспетчер, я хочу автоматически находить грузы на платформе Trans.eu, соответствующие местоположению и характеристикам моей машины, чтобы сэкономить время на ручном поиске, а также чтобы система могла автоматически обновлять информацию о грузах и я мог видеть их в таблице "Грузы". Также система должна позволять подбирать наиболее оптимальные грузы для моей машины на основе характеристик машины и груза.

**Почему этот приоритет**: Ключевая ценность продукта. Без данных TMS система пуста.

**Независимый тест**:
1. Запустить скрапер с конкретными фильтрами (Откуда: "SK, 82106", Радиус: 75км).
2. Проверить, что система запускает браузер (в фоновом или видимом режиме), переходит на Trans.eu, логинится, применяет фильтры и сохраняет результаты в локальную базу данных.

**Сценарии приемки**:
1. **Дано**: Выбран грузовик с известным местоположением либо местоположение введено вручную, **Когда** я нажимаю "Запустить скрапер", **Тогда** система должна заполнить поле "Откуда" местоположением грузовика + радиус 75 км.
2. **Дано**: Указаны даты загрузки/разгрузки, **Когда** скрапер запускается, **Тогда** он должен применить эти фильтры дат в интерфейсе Trans.eu.
3. **Дано**: Список результатов на Trans.eu, **Когда** скрапинг завершен, **Тогда** я должен видеть эти грузы в таблице "Грузы" в TMS.

---

### История 2 - Управление автопарком (Приоритет: P2)

Как менеджер автопарка, я хочу сохранять детали о моих грузовиках (габариты, грузоподъемность, GPS ID), чтобы фильтровать грузы, подходящие для конкретных машин.

**Почему этот приоритет**: Необходимо для точной фильтрации и логистического планирования.

**Независимый тест**:
1. Создать новый грузовик через UI/API.
2. Заполнить габариты (Д: 4.8, Ш: 2.4, В: 2.2).
3. Проверить, что данные сохранились и доступны для логики скрапера.

**Сценарии приемки**:
1. **Дано**: Я на странице "Мои грузовики", **Когда** я нажимаю "Добавить грузовик", **Тогда** я должен иметь возможность ввести госномер, габариты и код GPS.
2. **Дано**: Грузовик с кодом GPS, **Когда** я запускаю обновление GPS, **Тогда** система должна получить последние координаты и обновить поле `last_known_location`.

---

### История 3 - Визуальное управление грузами (Приоритет: P1)

Как диспетчер, я хочу просматривать найденные грузы в современной, удобной таблице с сортировкой и фильтрацией, чтобы быстро находить лучшие предложения.

**Почему этот приоритет**: Пользовательский опыт (UX). Требуется "премиальное" ощущение от интерфейса.

**Независимый тест**:
1. Открыть страницу `/freights` с 20+ грузами в базе данных. Использовать пагинацию.
2. Проверить, что таблица рендерится быстро, выглядит визуально привлекательно (современный стиль) и позволяет сортировать по Расстоянию и Цене, а также фильтровать по статусу груза.

**Сценарии приемки**:
1. **Дано**: Список грузов, **Когда** я навожу курсор на строку, **Тогда** она должна эффективно подсвечиваться (ощущение "живого" интерфейса).
2. **Дано**: Высокоприоритетные грузы (например, со статусом "Сделка"), **Когда** они просматриваются, **Тогда** они должны визуально выделяться.

---

## Требования

### Функциональные требования

- **FR-001**: Система ДОЛЖНА интегрироваться с Trans.eu через Playwright для скрапинга.
- **FR-002**: Система ДОЛЖНА поддерживать надежное взаимодействие с DOM элементами (устойчивость к изменениям верстки), чтобы считывать детали груза, даже если они скрыты или подгружаются динамически.Должна обеспечивать стабильность и надежность в работе с данными.
- **FR-003**: Система ДОЛЖНА позволять задавать габариты грузовика (`cargo_length`, `cargo_width`, `cargo_height`, `max_payload`).
- **FR-004**: Система ДОЛЖНА рассчитывать расстояния (например, от Грузовика до Места загрузки), чтобы сортировать грузы по эффективности.
- **FR-005**: Система ДОЛЖНА предоставлять REST API для получения данных фронтендом.
- **FR-006**: Фронтенд ДОЛЖЕН быть построен на React и Tailwind CSS, следуя гайдлайнам "Премиум" дизайна (градиенты, анимации).

### Ключевые сущности

- **Freight (Груз)**: Представляет предложение груза.
    - `trans_id` (Уникальный ID из Trans.eu)
    - `loading_place` (Место загрузки), `unloading_place` (Место разгрузки)
    - `price_original` (Цена), `distance_km` (Расстояние)
    - `cargo_info` (Вес, Габариты)
- **Truck (Грузовик)**: Представляет транспортное средство.
    - `license_plate` (Госномер)
    - `dimensions` (Д/Ш/В)
    - `gps_vehicle_code` (код для интеграции)
- **Settings (Настройки)**: Конфигурация системы (например, учетные данные, радиус по умолчанию).

## Критерии успеха

### Измеримые результаты

- **SC-001**: Скрапер успешно извлекает 90%+ видимых грузов с первой страницы результатов на Trans.eu.
- **SC-002**: Время загрузки страницы "Список грузов" составляет менее 1 секунды для < 500 записей.
- **SC-003**: Пользователь может запустить поиск для конкретного грузовика в 1 клик.
- **SC-004**: UI получает положительную оценку за "Премиальную эстетику" (субъективно, но проверяемо через отзывы).
